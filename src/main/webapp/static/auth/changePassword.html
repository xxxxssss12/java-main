<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>修改密码</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="../tools/ligerUI/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css" />
    <link href="../tools/ligerUI/ligerUI/skins/ligerui-icons.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
        .font-yahei {
            font-family: "Microsoft YaHei UI";
        }
    </style>
</head>
<body>
<div id="changePwdForm">

</div>
<button type="button" id="save" class="l-button l-button-submit">保存</button>

<script src="../js/jquery-3.1.1.min.js"></script>
<script src="../tools/ligerUI/ligerUI/js/ligerui.all.min.js"></script>
<script src="../js/common.js"></script>
<script>
    var userLevel = [{"id":1,"name":"查"},{"id":2,"name":"增查"},{"id":3,"name":"增改查"},{"id":4,"name":"增删改查"}];
    var addFlag = false;
    var roleList = [];
    $.ajax({
        url : baseUrl + "role/getAllRole",
        dataType: 'json',
        success: function(ri) {
            if (ri && ri.code == 1) {
                roleList = ri.data;
                initForm();
            } else {
                $.ligerDialog.error(ri.message);
            }
        },
        error: function() {
            $.ligerDialog.error("请网络异常，刷新页面重试");
        }
    })
    var initForm = function () {
        $("#changePwdForm").ligerForm({
            inputWidth: 200, labelWidth: 90, space: 40,
            fields: [
                { display:"密码",name:"password", newline: true, type:'password'},
                { display:"密码确认",name:"passwordConfirm", newline: true, type:'password'}
            ]
        });
    }
    $("#save").click(function () {
        var id = getRequestParams()["userid"];
        var password = $("input[ligeruiid=password]").val();
        var passwordConfirm = $("input[ligeruiid=passwordConfirm]").val();
        if (!password || password.length < 6) {
            $.ligerDialog.error("密码不能小于6个字符");
            return;
        }
        if (password != passwordConfirm) {
            $.ligerDialog.error("两次输入的密码不正确");
            return;
        }
        if (addFlag) {
            $.ligerDialog.error("操作处理中，请稍后重试");
            return;
        }
        addFlag=true;
        $.ajax({
            url: baseUrl + "user/updatePassword",
            type: 'post',
            data: {
                id: id,
                password: password
            },
            dataType: "json",
            success: function (ri) {
                addFlag = false;
                if (ri && ri.code == 1) {
                    $.ligerDialog.success("保存成功");
                    $("input[ligeruiid=password]").val("");
                    $("input[ligeruiid=passwordConfirm]").val("");
                } else {
                    $.ligerDialog.error(ri.message);
                }
            },
            error: function () {
                $.ligerDialog.error("网络异常");
                addFlag = false;
            }
        });
    })
</script>
</body>
</html>